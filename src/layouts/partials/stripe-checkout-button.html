<script src="https://js.stripe.com/v3/"></script>

<button
  style="background-color:#159957;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em;cursor:pointer"
  class="checkout-button"
  role="link"
  type="button"
>
  {{ .button | default "Sponsor!" }}
</button>

<div id="error-message" style="color: red; margin-top: 10px;"></div>

<script>
  (function() {
    // Initialize Stripe with your public key
    var stripe = Stripe('pk_live_51Rbp2lH5BRP1wdS75rdUMgAAaThFPGMhf0qPhWWmEOVY6YT59LIznmg2sPdjY50dCF2XcDEtjYlrp1UrugR8ND4b00nnTB7iTl');
    // Find the checkout button
    var checkoutButton = document.getElementById('checkout-button');

    // Add click event listener to the button
    checkoutButton.addEventListener('click', function() {

      // Debugging: Log data being sent to Stripe
      console.log('Stripe initialized:', stripe);
      console.log('Price ID:', "{{ .stripe_id }}");
      console.log('Success URL:', '{{ absURL "" }}/{{ .success_redirect | default "donations" }}/');
      console.log('Cancel URL:', '{{ absURL "" }}/{{ .cancel_redirect | default "donations" }}/');

      // Attempt to redirect to Stripe Checkout
      stripe.redirectToCheckout({
        lineItems: [{ price: "{{ .stripe_id }}", quantity: 1 }], // Ensure .stripe_id is valid
        mode: 'payment',
        successUrl: '{{ absURL "" }}/{{ .success_redirect | default "donations" }}/',
        cancelUrl: '{{ absURL "" }}/{{ .cancel_redirect | default "donations" }}/',
      })
      .then(function(result) {
        if (result.error) {
          // Display error message
          var displayError = document.getElementById('error-message');
          displayError.textContent = result.error.message;

          // Debugging: Log the error to the console
          console.error('Stripe Checkout Error:', result.error.message);
        }
      });
    });
  })();
</script>